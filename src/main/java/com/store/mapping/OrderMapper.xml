<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper 
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!--命名空间应该是对应接口的包名+接口名 -->
<mapper namespace="com.store.dao.OrderDao">
	<insert id="save">
	insert into orders (oid,ordertime,total,state,address,name,telephone,uid) 
	values (#{oid},#{ordertime},#{total},#{state},#{address},#{name},#{telephone},#{user.uid})
	</insert>
	
	<insert id="saveItem">
	insert into orderitem (itemid,count,subtotal,pid,oid) 
	values (#{itemid},#{count},#{subtotal},#{product.pid},#{order.oid})
	</insert>
	
	<update id="update">
	update orders set state = #{state},address = #{address}, name =#{name}, telephone = #{telephone} where oid =#{oid}
	</update>
	
	
	<select id="getById" resultType="com.store.model.Order">
		select  * from orders where oid = #{oid}
	</select>
	
	<select id="getList" resultType="java.util.Map" >
	 <![CDATA[
          SELECT * FROM orderitem oi,product p WHERE oi.pid = p.pid AND oi.oid =#{oid}

        ]]></select>
        
        <select id="findMyOrdersByPage" parameterType="hashmap" resultType="com.store.model.Order">
        
        select * from orders where uid =#{uid} order by ordertime desc 
    
        </select>
        
        <select id="getByuid" parameterType="string"  resultType="string">
        
        select oid from orders where uid =#{uid}
        </select>
    
    
  	<select id="findAllByState" resultType="com.store.model.Order">
  	   select * from orders 
  	    <if test="state == null || state.trim().length()==0">
  	      order by ordertime desc
  	    </if>
  	    <where>
  	   <if test=" state != null">
  	      state =#{state} order by ordertime desc
  	   </if>
  	   </where>
  	</select>
</mapper>
